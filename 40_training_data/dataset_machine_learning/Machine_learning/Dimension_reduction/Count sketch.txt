Count sketch is a type of dimensionality reduction that is particularly efficient in statistics, machine learning and algorithms.

It was invented by Moses Charikar, Kevin Chen and Martin Farach-Colton in an effort to speed up the AMS Sketch by Alon, Matias and Szegedy for approximating the frequency moments of streams (these calculations require counting of the number of occurrences for the distinct elements of the stream).

The sketch is nearly identical to the Feature hashing algorithm by John Moody, but differs in its use of hash functions with low dependence, which makes it more practical.

In order to still have a high probability of success, the median trick is used to aggregate multiple count sketches, rather than the mean.

These properties allow use for explicit kernel methods, bilinear pooling in neural networks and is a cornerstone in many numerical linear algebra algorithms.

Intuitive explanation

The inventors of this data structure offer the following iterative explanation of its operation:

at the simplest level, the output of a single hash function  mapping stream elements  into {+1, -1} is feeding a single up/down counter . After a single pass over the data, the frequency n(q) of a stream element  can be approximated, although extremely poorly, by the expected value \bold E[C \cdot s(q)];

a straightforward way to improve the variance of the previous estimate is to use an array of different hash functions s_i, each connected to its own counter C_i. For each element , the \bold E[C_i \cdot s_i(q)]= n(q) still holds, so averaging across the  range will tighten the approximation;

the previous construct still has a major deficiency: if a lower-frequency-but-still-important output element  exhibits a hash collision with a high-frequency element, n(a) estimate can be significantly affected. Avoiding this requires reducing the frequency of collision counter updates between any two distinct elements. This is achieved by replacing each C_i in the previous construct with an array of  counters (making the counter set into a two-dimensional matrix C_{i,j}), with index  of a particular counter to be incremented/decremented selected via another set of hash functions h_i that map element  into the range {1..}. Since \bold E[C_{i, h_i(q)} \cdot s_i(q)] = n(q), averaging across all values of  will work.

Mathematical definition

1. For constants w and t (to be defined later) independently choose d=2t+1 random hash functions

h_1, \dots, h_d and s_1,\dots,s_d such that

h_i : [n] \to [w] and

s_i : [n] \to \{\pm 1\}.

It is necessary that the hash families from which h_i and s_i are chosen be pairwise independent.

2. For each item q_i in the stream, add s_j(q_i) to the h_j(q_i)th bucket of the jth hash.

At the end of this process, one has wd sums (C_{ij}) where

C_{i,j} = \sum_{h_i(k)=j}s_i(k).

To estimate the count of qs one computes the following value:

r_q = \text{median}_{i=1}^d\, s_i(q)\cdot C_{i, h_i(q)}.

The values s_i(q)\cdot C_{i, h_i(q)} are unbiased estimates of how many times q has appeared in the stream.

The estimate r_q has variance O(\mathrm{min}\{m_1^2/w^2, m_2^2/w\}), where

m_1 is the length of the stream and m_2^2 is \sum_q (\sum_i [q_i=q])^2.

Furthermore, r_q is guaranteed to never be more than 2m_2/\sqrt{w} off from the true value, with probability 1-e^{-O(t)}.

Vector formulation

Alternatively Count-Sketch can be seen as a linear mapping with a non-linear reconstruction function.

Let M^{(i\in[d])}\in\{-1,0,1\}^{w \times n}, be a collection of d=2t+1 matrices, defined by

M^{(i)}_{h_i(j),j} = s_i(j)

for j\in[w] and 0 everywhere else.

Then a vector v\in\mathbb{R}^n is sketched by C^{(i)} = M^{(i)} v \in \mathbb{R}^w.

To reconstruct v we take v^*_j = \text{median}_i C^{(i)}_j s_i(j).

This gives the same guarantees as stated above, if we take m_1=\|v\|_1 and m_2=\|v\|_2.

Relation to Tensor sketch

The count sketch projection of the outer product of two vectors is equivalent to the convolution of two component count sketches.

The count sketch computes a vector convolution

C^{(1)}x \ast C^{(2)}x^T, where C^{(1)} and C^{(2)} are independent count sketch matrices.

Pham and Pagh  show that this equals C(x \otimes x^T) – a count sketch C of the outer product of vectors, where  \otimes  denotes Kronecker product.

The fast Fourier transform can be used to do fast convolution of count sketches.

By using the face-splitting product such structures can be  computed much faster than normal matrices.

See also

Count–min sketch is a version of algorithm with smaller memory requirements (and weaker error guarantees as a tradeoff).

Tensor sketch

References

Further reading

Faisal M. Algashaam; Kien Nguyen; Mohamed Alkanhal; Vinod Chandran; Wageeh Boles. "Multispectral Periocular Classification WithMultimodal Compact Multi-Linear Pooling" . IEEE Access, Vol. 5. 2017.

Category:Dimension reduction

Category:Hash-based data structures

Category:Probabilistic data structures