In machine learning, attention is a method that determines the importance of each component in a sequence relative to the other components in that sequence. In natural language processing, importance is represented by "soft" weights assigned to each word in a sentence. More generally, attention encodes vectors called token embeddings across a fixed-width sequence that can range from tens to millions of tokens in size.

Unlike "hard" weights, which are computed during the backwards training pass, "soft" weights exist only in the forward pass and therefore change with every step of the input. Earlier designs implemented the attention mechanism in a serial recurrent neural network (RNN) language translation system, but a more recent design, namely the transformer, removed the slower sequential RNN and relied more heavily on the faster parallel attention scheme.

Inspired by ideas about attention in humans, the attention mechanism was developed to address the weaknesses of using information from the hidden layers of recurrent neural networks. Recurrent neural networks favor more recent information contained in words at the end of a sentence, while information earlier in the sentence tends to be attenuated. Attention allows a token equal access to any part of a sentence directly, rather than only through the previous state.

History

{| class="wikitable"

1950s–1960s

Psychology and biology of attention. Cocktail party effect

-

2014

seq2seq with RNN + Attention. and Soydaner.

The major breakthrough came with self-attention, where each element in the input sequence attends to all others, enabling the model to capture global dependencies. This idea was central to the Transformer architecture, which replaced recurrence with attention mechanisms. As a result, Transformers became the foundation for models like BERT, T5 and generative pre-trained transformers (GPT).

FlexAttention

FlexAttention is an attention kernel developed by Meta that allows users to modify attention scores prior to softmax and dynamically chooses the optimal attention algorithm.

Applications

Attention is widely used in natural language processing, computer vision, and speech recognition. In NLP, it improves context understanding in tasks like question answering and summarization. In vision, visual attention helps models focus on relevant image regions, enhancing object detection and image captioning.

Attention maps as explanations for vision transformers

From the original paper on vision transformers (ViT), visualizing attention scores as a heat map (called saliency maps or attention maps) has become an important and routine way to inspect the decision making process of ViT models. One can compute the attention maps with respect to any attention head at any layer, while the deeper layers tend to show more semantically meaningful visualization. Attention rollout is a recursive algorithm to combine attention scores across all layers, by computing the dot product of successive attention maps.

Because vision transformers are typically trained in a self-supervised manner, attention maps are generally not class-sensitive. When a classification head attached to the ViT backbone, class-discriminative attention maps (CDAM) combines attention maps and gradients with respect to the class [CLS] token. Some class-sensitive interpretability methods originally developed for convolutional neural networks can be also applied to ViT, such as GradCAM, which back-propagates the gradients to the outputs of the final attention layer.

Using attention as basis of explanation for the transformers in language and vision is not without debate. While some pioneering papers analyzed and framed attention scores as explanations, higher attention scores do not always correlate with greater impact on model performances.

Mathematical representation

Standard scaled dot-product attention

For matrices: Q\in\mathbb{R}^{m\times d_k}, K\in\mathbb{R}^{n\times d_k} and V\in\mathbb{R}^{n\times d_v}, the scaled dot-product, or QKV attention, is defined as:

\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}\right)V\in\mathbb{R}^{m\times d_v}

where {}^T denotes transpose and the softmax function is applied independently to every row of its argument. The matrix Q contains m queries, while matrices K, V jointly contain an unordered set of n key-value pairs. Value vectors in matrix V are weighted using the weights resulting from the softmax operation, so that the rows of the m-by-d_v output matrix are confined to the convex hull of the points in \mathbb{R}^{d_v} given by the rows of V.

To understand the permutation invariance and permutation equivariance properties of QKV attention, let A\in\mathbb{R}^{m\times m} and B\in\mathbb{R}^{n\times n} be permutation matrices; and D\in\mathbb{R}^{m\times n} an arbitrary matrix. The softmax function is permutation equivariant in the sense that:

\text{softmax}(ADB) = A\,\text{softmax}(D)B

By noting that the transpose of a permutation matrix is also its inverse, it follows that:

\text{Attention}(AQ, BK, BV) = A\,\text{Attention}(Q, K, V)

which shows that QKV attention is equivariant with respect to re-ordering the queries (rows of Q); and invariant to re-ordering of the key-value pairs in K, V. These properties are inherited when applying linear transforms to the inputs and outputs of QKV attention blocks. For example, a simple self-attention function defined as:

X\mapsto\text{Attention}(XT_q, XT_k, XT_v)

is permutation equivariant with respect to re-ordering the rows of the input matrix X in a non-trivial way, because every row of the output is a function of all the rows of the input. Similar properties hold for multi-head attention, which is defined below.

Masked attention

When QKV attention is used as a building block for an autoregressive decoder, and when at training time all input and output matrices have n rows, a masked attention variant is used:

\text{Attention}(Q, K, V) = \text{softmax}\left(\frac{QK^T}{\sqrt{d_k}}+M\right)V

where the mask, M\in\mathbb{R}^{n\times n} is a strictly upper triangular matrix, with zeros on and below the diagonal and -\infty in every element above the diagonal. The softmax output, also in \mathbb{R}^{n\times n} is then lower triangular, with zeros in all elements above the diagonal. The masking ensures that for all 1\le i, row i of the attention output is independent of row j of any of the three input matrices. The permutation invariance and equivariance properties of standard QKV attention do not hold for the masked variant.

Multi-head attention

Multi-head attention

\text{MultiHead}(Q, K, V) = \text{Concat}(\text{head}_1, ..., \text{head}_h)W^O

where each head is computed with QKV attention as:

\text{head}_i = \text{Attention}(QW_i^Q, KW_i^K, VW_i^V)

and W_i^Q, W_i^K, W_i^V, and W^O are parameter matrices.

The permutation properties of (standard, unmasked) QKV attention apply here also. For permutation matrices, A, B:

\text{MultiHead}(AQ, BK, BV) = A\,\text{MultiHead}(Q, K, V)

from which we also see that multi-head self-attention:

X\mapsto\text{MultiHead}(XT_q, XT_k, XT_v)

is equivariant with respect to re-ordering of the rows of input matrix X.

Bahdanau (additive) attention

\text{Attention}(Q, K, V) = \text{softmax}(\tanh(W_QQ + W_KK))V

where W_Q and W_K are learnable weight matrices.

External links

Dan Jurafsky and James H. Martin (2022). Speech and Language Processing (3rd ed. draft, January 2022) — Chapter 10.4 (Attention) and Chapter 9.7 (Self-Attention Networks: Transformers)

Alex Graves (2020). Attention and Memory in Deep Learning — video lecture from DeepMind / UCL

Category:Machine learning